# Supabase セットアップガイド

このアプリ（007-ai-ocr）を動作させるための、Supabaseのセットアップ手順です。

## 手順 1: Supabase プロジェクトの作成

1. [Supabase](https://supabase.com/) にアクセスし、「Start your project」をクリックしてアカウント作成（またはログイン）します。
2. 「New Project」ボタンをクリックします。
3. 以下の情報を入力してプロジェクトを作成します：
   - **Name**: `webapps-100` （任意の名前でOK）
   - **Database Password**: 強力なパスワードを設定（忘れないようにメモしてください）
   - **Region**: `Tokyo (Japan)` （または近いリージョン）
4. 「Create new project」をクリックし、セットアップが完了するまで数分待ちます。

## 手順 2: APIキーの取得

1. プロジェクトのダッシュボードが開いたら、左下の **Settings**（歯車アイコン）をクリックします。
2. **API** を選択します。
3. 以下の2つの値をコピーします：
   - **Project URL**
   - **Project API keys** の `anon` `public` キー

## 手順 3: 環境変数の設定

プロジェクトのルートディレクトリ（`package.json`がある場所）にある `.env.local` ファイルを開き（なければ作成し）、先ほどコピーした値を貼り付けます。

```env
NEXT_PUBLIC_SUPABASE_URL=ここにProject URLを貼り付け
NEXT_PUBLIC_SUPABASE_ANON_KEY=ここにanon public keyを貼り付け
```

## 手順 4: データベーステーブルの作成

1. Supabaseのダッシュボード左側のメニューから **SQL Editor** をクリックします。
2. 「New query」をクリックして、新しいクエリ作成画面を開きます。
3. 以下のSQLコードをコピーして貼り付け、「Run」ボタンを押して実行します。

```sql
-- 受発注データを保存するテーブルを作成
create table extracted_orders (
  id bigint generated by default as identity primary key,
  created_at timestamp with time zone default timezone('utc'::text, now()) not null,
  customer_name text not null,
  delivery_date date not null,
  total_amount bigint not null,
  items jsonb not null
);

-- Row Level Security (RLS) を有効化
alter table extracted_orders enable row level security;

-- 誰でも読み書きできるようにポリシーを設定（MVP用）
-- 本番環境では認証済みユーザーのみに制限することを推奨
create policy "Enable read access for all users"
on extracted_orders for select
using (true);

create policy "Enable insert access for all users"
on extracted_orders for insert
with check (true);
```

## 手順 5: 動作確認

1. アプリを起動します：
   ```bash
   npm run dev
   ```
2. `http://localhost:3000/apps/007-ai-ocr` にアクセスします。
3. ファイルをアップロードして解析（モック）し、「データベースへ保存」ボタンを押します。
4. 保存が成功し、下の「最近の保存データ」一覧に表示されれば成功です！
